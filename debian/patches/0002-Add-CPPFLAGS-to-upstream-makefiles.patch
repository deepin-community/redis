From: Chris Lamb <lamby@debian.org>
Date: Fri, 30 Oct 2015 10:53:42 +0000
Subject: Add CPPFLAGS and CXXFLAGS to upstream makefiles

.
---
 deps/fast_float/Makefile    | 2 +-
 deps/fpconv/Makefile        | 2 +-
 deps/hdr_histogram/Makefile | 2 +-
 deps/linenoise/Makefile     | 2 +-
 src/Makefile                | 2 +-
 5 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/deps/fast_float/Makefile b/deps/fast_float/Makefile
index d3e5d30..92f535f 100644
--- a/deps/fast_float/Makefile
+++ b/deps/fast_float/Makefile
@@ -2,7 +2,7 @@
 CC ?= gcc
 CXX ?= g++
 
-CFLAGS=-Wall -O3
+CFLAGS=$(shell dpkg-buildflags --get CXXFLAGS) $(shell dpkg-buildflags --get CPPFLAGS)
 # This avoids loosing the fastfloat specific compile flags when we override the CFLAGS via the main project
 FASTFLOAT_CFLAGS=-std=c++11 -DFASTFLOAT_ALLOWS_LEADING_PLUS
 LDFLAGS=
diff --git a/deps/fpconv/Makefile b/deps/fpconv/Makefile
index 2654888..64d2ed0 100644
--- a/deps/fpconv/Makefile
+++ b/deps/fpconv/Makefile
@@ -2,7 +2,7 @@ STD=
 WARN= -Wall
 OPT= -Os
 
-R_CFLAGS= $(STD) $(WARN) $(OPT) $(DEBUG) $(CFLAGS)
+R_CFLAGS= $(STD) $(WARN) $(OPT) $(DEBUG) $(CFLAGS) $(CPPFLAGS)
 R_LDFLAGS= $(LDFLAGS)
 DEBUG= -g
 
diff --git a/deps/hdr_histogram/Makefile b/deps/hdr_histogram/Makefile
index 28dd93e..3a6413e 100644
--- a/deps/hdr_histogram/Makefile
+++ b/deps/hdr_histogram/Makefile
@@ -2,7 +2,7 @@ STD= -std=c99
 WARN= -Wall
 OPT= -Os
 
-R_CFLAGS= $(STD) $(WARN) $(OPT) $(DEBUG) $(CFLAGS) -DHDR_MALLOC_INCLUDE=\"hdr_redis_malloc.h\"
+R_CFLAGS= $(STD) $(WARN) $(OPT) $(DEBUG) $(CFLAGS) $(CPPFLAGS) -DHDR_MALLOC_INCLUDE=\"hdr_redis_malloc.h\"
 R_LDFLAGS= $(LDFLAGS)
 DEBUG= -g
 
diff --git a/deps/linenoise/Makefile b/deps/linenoise/Makefile
index 1dd894b..12ada21 100644
--- a/deps/linenoise/Makefile
+++ b/deps/linenoise/Makefile
@@ -6,7 +6,7 @@ R_CFLAGS= $(STD) $(WARN) $(OPT) $(DEBUG) $(CFLAGS)
 R_LDFLAGS= $(LDFLAGS)
 DEBUG= -g
 
-R_CC=$(CC) $(R_CFLAGS)
+R_CC=$(CC) $(R_CFLAGS) $(CPPFLAGS)
 R_LD=$(CC) $(R_LDFLAGS)
 
 linenoise.o: linenoise.h linenoise.c
diff --git a/src/Makefile b/src/Makefile
index e3a76ed..179a9c4 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -335,7 +335,7 @@ else
     endef
 endif
 
-REDIS_CC=$(QUIET_CC)$(CC) $(FINAL_CFLAGS)
+REDIS_CC=$(QUIET_CC)$(CC) $(FINAL_CFLAGS) $(CPPFLAGS)
 REDIS_LD=$(QUIET_LINK)$(CC) $(FINAL_LDFLAGS)
 REDIS_INSTALL=$(QUIET_INSTALL)$(INSTALL)
 
